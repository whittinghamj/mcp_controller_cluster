<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.4.4/proj4.js"></script>
<script src="https://code.highcharts.com/maps/highmaps.js"></script>
<script src="http://code.highcharts.com/mapdata/custom/world.js"></script>
<div id="container"></div>

<style type="text/css">
    #container {
        height: 600px;
        min-width: 450px;
        max-width: 1000;
        margin: 0 auto;
    }
    .loading {
        margin-top: 10em;
        text-align: center;
        color: gray;
    }
</style>

<script type="text/javascript">


// Initialize the chart
var chart = Highcharts.mapChart('container', {

    title: {
        text: 'MCP Cluster Map'
    },

    legend: {
        align: 'left',
        layout: 'vertical',
        floating: true
    },

    mapNavigation: {
        enabled: true
    },

    tooltip: {
        formatter: function () {
            return this.point.id;
        }
    },

    plotOptions: {
        series: {
            marker: {
                fillColor: '#FFFFFF',
                lineWidth: 2,
                lineColor: Highcharts.getOptions().colors[1]
            }
        }
    },

    series: [{
        // Use the gb-all map with no data as a basemap
        mapData: Highcharts.maps['custom/world'],
        name: 'Basemap',
        borderColor: '#707070',
        nullColor: 'rgba(200, 200, 200, 0.3)',
        showInLegend: false
    }, {
        name: 'Separators',
        type: 'mapline',
        data: Highcharts.geojson(Highcharts.maps['custom/world'], 'mapline'),
        color: '#707070',
        showInLegend: false,
        enableMouseTracking: false
    }, {
        // Specify cities using lat/lon
        type: 'mappoint',
        name: 'Cities',
        dataLabels: {
            format: '{point.id}'
        },
        // Use id instead of name to allow for referencing points later using
        // chart.get
        data: [{
            id: 'MCP',
            lat: 37.548271,
            lon: -121.988571
        },{
            id: 'Castle Rock',
            lat: 39.443901062012,
            lon: -104.85150146484
        }, {
            id: 'Darwen',
            lat: 53.48095,
            lon: -2.237430
        }, {
            id: 'Pocatello',
            lat: 42.8876,
            lon: -112.4381
        }]
    }]
});

// Function to return an SVG path between two points, with an arc
function pointsToPath(from, to, invertArc) {
    var arcPointX = (from.x + to.x) / (invertArc ? 2.4 : 1.6),
        arcPointY = (from.y + to.y) / (invertArc ? 2.4 : 1.6);
    return 'M' + from.x + ',' + from.y + 'Q' + arcPointX + ' ' + arcPointY +
            ',' + to.x + ' ' + to.y;
}

var 
castle_rock = chart.get('Castle Rock'),
darwen = chart.get('Darwen'),
mcp = chart.get('MCP');

chart.addSeries({
    name: 'Slave > Master Connections',
    type: 'mapline',
    lineWidth: 2,
    color: Highcharts.getOptions().colors[8],
    data: [{
        id: 'Master to Slave',
        path: pointsToPath(darwen, chart.get('Darwen'), true)
    }, {
        id: 'Master to Slave',
        path: pointsToPath(castle_rock, chart.get('Pocatello'), true)
    }]
});

chart.addSeries({
    name: 'Master > MCP Connections',
    type: 'mapline',
    lineWidth: 2,
    color: Highcharts.getOptions().colors[4],
    data: [{
        id: 'Master to MCP',
        path: pointsToPath(mcp, chart.get('Castle Rock'), true)
    },{
        id: 'Master to MCP',
        path: pointsToPath(mcp, chart.get('Darwen'), true)
    }]
});



</script>